<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Solo Record Scorer</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:24px}
        textarea{width:100%;height:160px;margin-top:8px;box-sizing:border-box;max-width:100%;padding:8px;font-size:16px;resize:vertical}
        .row{display:flex;gap:8px;align-items:center;margin-top:8px}
        #results{margin-top:12px;padding:12px;border:1px solid #ddd;border-radius:6px;background:#fafafa}
        .invalid{color:#b00}
        .solorecordbtn{padding:8px 12px;cursor:pointer}

        /* Responsive adjustments for phones/smaller screens */
        @media (max-width: 480px) {
            body{margin:12px}
            textarea{height:120px;font-size:14px}
            .row{flex-direction:column;align-items:stretch}
            .solorecordbtn{width:100%}
            #results{padding:10px}
        }
    </style>
</head>
<body>
    <h1 id="solorecord">SOLO RECORD SCORER</h1>
    <p>Paste your sheet record into the box. Entries can be separated by tabs, spaces, or newlines.</p>

    <div class="row">
        <button id="clearBtn" class="solorecordbtn">Clear</button>
    </div>

    <textarea id="sheetInput" placeholder="Paste sheet record here (e.g. WIN TOP HIGH SAFE LOW BTM ELIM)"></textarea>
    <div class="row">
        <button id="processBtn" class="solorecordbtn">Process</button>
        <button id="copyResult" class="solorecordbtn">Copy Results</button>
    </div>

    <div id="results" aria-live="polite"></div>

    <script>
        const sheetInput = document.getElementById('sheetInput');
        const processBtn = document.getElementById('processBtn');
        const results = document.getElementById('results');
        const clearBtn = document.getElementById('clearBtn');
        const copyResult = document.getElementById('copyResult');
        let lastResult = null;

        function scoreForChar(ch){
            switch(ch.toLowerCase()){
                case 'w': return 10;
                case 't': return 9;
                case 'h': return 8;
                case 's': return 5;
                case 'l': return 3;
                case 'b': return 1;
                case 'e': return 0;
                default: return null;
            }
        }

        function processText(text){
            if(!text) { results.innerHTML = '<em>No input provided.</em>'; return; }

            // Split on any whitespace (tabs, newlines, spaces)
            const raw = text.trim().split(/\s+/).filter(s => s.trim() !== '');
            let count = 0;
            let score = 0;
            const invalids = [];

            raw.forEach(item => {
                const placement = item.trim();
                if(placement === '') return;
                const ch = placement.charAt(0);
                const val = scoreForChar(ch);
                if(val === null){
                    invalids.push(placement);
                } else {
                    score += val;
                    count += 1;
                }
            });

            const avg = count > 0 ? (score / count) : 0;

            let out = '';
            out += `<div><strong>SCORE:</strong> ${score}</div>`;
            out += `<div><strong>PPE:</strong> ${count>0? avg.toFixed(2) : 'N/A'}</div>`;
            out += `<div><strong>Counted entries:</strong> ${count}</div>`;
            if(invalids.length){
                out += `<div class="invalid"><strong>Invalid entries:</strong> ${invalids.join(', ')}</div>`;
                out += `<div class="invalid">If an entry is a disqualification or similar, please write "ELIM".</div>`;
            }

            results.innerHTML = out;
            return {score, avg, count, invalids};
        }

        processBtn.addEventListener('click', () => processText(sheetInput.value));
        processBtn.addEventListener('click', () => { lastResult = processText(sheetInput.value); });

        clearBtn.addEventListener('click', () => { sheetInput.value = ''; results.innerHTML = ''; lastResult = null; });

        copyResult.addEventListener('click', async () => {
            try{
                if(!lastResult) lastResult = processText(sheetInput.value) || {score:0,avg:0,count:0};
                const score = lastResult.score ?? 0;
                const ppe = (lastResult.count>0) ? Number(lastResult.avg).toFixed(2) : '0.00';
                const toCopy = `${score}\t${ppe}`;
                await navigator.clipboard.writeText(toCopy);
                copyResult.textContent = 'Copied!';
                setTimeout(()=>copyResult.textContent = 'Copy Results', 1500);
            }catch(e){
                alert('Copy failed: '+ e.message);
            }
        });
    </script>
</body>
</html>
